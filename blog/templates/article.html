{% extends 'base.html' %}
{% block title %}{{ post.title }}{% endblock %}
{% block main_content %}
    <!-- post block -->
    <div class="blog-post">
        <h3 class="blog-post-title"><a>{{ object.title }}</a></h3>
        <p class="blog-post-meta">{{ object.posted_time }} by <a href="#">{{ object.author }}</a></p>
        <hr>
        <p>{{ object.content|safe }}</p>
    </div>
    <hr>
    <div class="blog-category">
        {% url 'blog:category' object.category.id as category_id %}
        <p>Categories: <a href="{{ category_id }}">{{ object.category }}</a>
        </p>
    </div>
    <div class="blog-tag">
        <p>Tags:
            {% for tag in post.tag.all %}
                <a href="#">{{ tag }}</a>
                {% if not forloop.last %}
                    |
                {% endif %}
            {% endfor %}
        </p>
    </div>
    <hr style="margin-bottom: 3rem">
    <!-- comments block -->
    <div class="blog-comments">
        <h2 id="publish">Comments</h2>
        <hr>
        <!-- a comment form created by ModelFrom module -->
        <div id="respond" class="comment-respond">
            <h3>Leave a message</h3>
            <form action="{% url 'blog:comment' %}" method="post" id="commentform" class="comment-form">
                <!-- hidden element, used to record replied user. -->
                <p class="comment-notes"><span id="email-notes">Your email address will not be published.</span>
                    Required fields are marked <span class="required">*</span></p>
                {% csrf_token %}
                <div class="form-group comment-form-author">{{ comment_form.name }}</div>
                <div class="form-group comment-form-email">{{ comment_form.email }}</div>
                <div class="form-group comment-form-comment">{{ comment_form.content }}</div>
                <div class="form-group comment-form-comment">
                    <input type="hidden" id="article" name="article" value="{{ object.id }}">
                </div>
                <div class="form-group comment-form-comment">
                    <input type="hidden" id="reply" name="reply" value="0">
                </div>
                <p class="form-submit">
                    <input name="submit" type="submit" id="submit_comment" class="submit" value="Post Comment">
                </p>

                <!-- message flash block-->
                {% include 'messages.html' %}
            </form>
        </div>
        <hr>
        {% for comment in comment_list %}
            {% if comment.reply == None %}  <!-- if no replay, then its a parent comment -->
                <div class="parent-comment">
                    <p class="comment-nav">{{ comment.name }} ({{ comment.posted_time }})</p>
                    <div class="comment-content" style="position: relative;">{{ comment.content }}
                        <a href="#publish" style="position: absolute; right: 0;bottom: 0;"
                           onclick="reply('{{ comment.name }}',{{ comment.id }})">reply</a>
                    </div>
                </div>
            {% else %}
                <div class="children-comment">
                    <p class="comment-nav">{{ comment.name }} >>> {{ comment.reply.name }}
                        ({{ comment.posted_time }})</p>
                    <div class="comment-content" style="position: relative;">{{ comment.content }}
                        <a href="#publish" style="position: absolute; right: 0;bottom: 0;"
                           onclick="reply('{{ comment.name }}',{{ comment.id }})">reply</a>
                    </div>
                </div>
            {% endif %}
        {% empty %}
            <a>No comments yet!</a>
        {% endfor %}
    </div>
    <script>
        function reply(comment_name, comment_id) {
            $('#content').attr('placeholder', 'Reply to ' + comment_name + ':'); // 设置内容输入框的提示
            $('#reply').val(comment_id) //设置隐藏元素的值为评论目标的id
        }

        function onload() {     // put this function in body element to load session
            $('#name').val('{{ session.name }}'); // 设置昵称为session中的昵称
            $('#email').val('{{ session.email }}'); // 设置邮箱为session中的邮箱
            $('#content').val('{{ session.content }}') // 设置内容为session中的内容
        }
    </script>
{% endblock %}